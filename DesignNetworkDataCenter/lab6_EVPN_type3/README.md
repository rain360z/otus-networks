# Лабораторная работ 4.
## Построение Overlay на основе VxLAN EVPN для L2 связанности между клиентами .

Цель.
Настроить маршрутизацию в рамках Overlay между клиентами
 - Настроите каждого клиента в своем VNI
 - Настроите маршрутизацию между клиентами


План работ:
1) Адресное пространство, настройку оборудования используем из четвёртой лабораторной.
2) Внесём изменения в схему.
3) Сконфигурируем оборудование.
4) Проверка работоспособности.

 
## 1. Распределение ip адресов.

Адресация из 2 лабораторной

Таблица адресов  
|Уровень| Оборудование | Интерфейс  | ip-адрес | Маска |  Маршрут по умолчанию |
|-------|--------------|------------|----------|-------|-----------------------|
|Leaf|L-NX9500_1 |e1/1    |172.16.1.1|255.255.255.254|N/A|
|    |           |e1/2    |172.16.1.3|255.255.255.254|N/A|
|    |           |lo      |1.1.1.1   |255.255.255.255|N/A|
|    |           |lo 100  |100.111.111.1   |255.255.255.255|N/A|
|Leaf|L-NX9500_2 |e1/1    |172.16.2.1|255.255.255.254|N/A|
|    |           |e1/2    |172.16.2.3|255.255.255.254|N/A|
|    |           |lo      |1.1.1.2   |255.255.255.255|N/A|
|    |           |lo 100  |100.111.111.1   |255.255.255.255|N/A|
|Leaf|L-NX9500_3 |e1/1    |172.16.3.1|255.255.255.254|N/A|
|    |           |e1/2    |172.16.3.3|255.255.255.254|N/A|
|    |           |lo      |1.1.1.3   |255.255.255.255|N/A|
|Spine|S-NX9500_1|e1/1    |172.16.1.0|255.255.255.254|N/A|
|     |          |e1/2    |172.16.2.0|255.255.255.254|N/A|
|     |          |e1/3    |172.16.3.0|255.255.255.254|N/A|
|     |          |lo      |2.2.2.1   |255.255.255.255|N/A|
|    |           |lo 100  |100.122.122.1   |255.255.255.255|N/A|
|Spine|S-NX9500_2|e1/1    |172.16.1.2|255.255.255.254|N/A|
|     |          |e1/2    |172.16.2.2|255.255.255.254|N/A|
|     |          |e1/3    |172.16.3.2|255.255.255.254|N/A|  
|     |          |lo      |2.2.2.2   |255.255.255.255|N/A|
|    |           |lo 100  |100.122.122.2   |255.255.255.255|N/A|


| Hostname | ASN   |router-id        |
|----------|-------|-----------------|
|S-NX9500_1|64601  |2.2.2.1          |
|S-NX9500_2|64601  |2.2.2.2          |
|L-NX9500_1|65001  |1.1.1.1          |
|L-NX9500_2|65002  |1.1.1.2          |
|L-NX9500_3|65003  |1.1.1.3          |  




## 2. Внесём изменения в схему

Подключим клиентов к LEAF c разными VNI и изолируем клиентов используя VRF.



|VLAN   |   Network   |    Hostname  |VRF   |
|-------|-------------|--------------|------|
|10     | 10.0.10.0/24|L-NX9500_1    |OTUS  |
|11     | 10.0.11.0/24|L-NX9500_3    |OTUS  |

![alt-text](img_1.png)

## 3. Сконфигурируем оборудование.

Для организации связи между клентам будем использовать модель Symmetric Integrated Routing and Briging

Сократим конфигурацию добавив tamplates 

на примере 64601 и 65001

router bgp 64601
  router-id 2.2.2.1
  timers bgp 3 9
  reconnect-interval 12
  log-neighbor-changes
  address-family l2vpn evpn
    maximum-paths 10
    retain route-target all
  template peer LEAF
    update-source loopback0
    ebgp-multihop 5
    address-family l2vpn evpn
      send-community
      send-community extended
      route-map NH_UNCHANGED out
      rewrite-evpn-rt-asn
  neighbor 1.1.1.1
    inherit peer LEAF
    remote-as 65001
  neighbor 1.1.1.3
    inherit peer LEAF
    remote-as 65003









## 4. Проверка работоспособности.

show bgp l2 evpn summary

show mac address-table


