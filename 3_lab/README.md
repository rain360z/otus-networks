# 3 Лабораторная работа. 

Развертывание коммутируемой сети с резервным каналом


### Задания
1. [Создание сети и настройка основных парамеров устройства](https://github.com/rain360z/otus-networks/tree/main/3_lab#%D1%87%D0%B0%D1%81%D1%82%D1%8C-1-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%B5%D1%82%D0%B8-%D0%B8-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D1%85-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%80%D0%BE%D0%B2-%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0)
2. [Выбор корневого моста](https://github.com/rain360z/otus-networks/tree/main/3_lab#%D1%87%D0%B0%D1%81%D1%82%D1%8C-2-%D0%B2%D1%8B%D0%B1%D0%B5%D1%80-%D0%BA%D0%BE%D1%80%D0%BD%D0%B5%D0%B2%D0%BE%D0%B3%D0%BE-%D0%BC%D0%BE%D1%81%D1%82%D0%B0)
3. [Наблюдение за процессом выбора протоколом STP порта, исходя 
из стоимости портов](https://github.com/rain360z/otus-networks/tree/main/3_lab#%D1%87%D0%B0%D1%81%D1%82%D1%8C-3%D0%BD%D0%B0%D0%B1%D0%BB%D1%8E%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B7%D0%B0-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D0%BC-%D0%B2%D1%8B%D0%B1%D0%BE%D1%80%D0%B0-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%BE%D0%BC-stp-%D0%BF%D0%BE%D1%80%D1%82%D0%B0-%D0%B8%D1%81%D1%85%D0%BE%D0%B4%D1%8F-%D0%B8%D0%B7-%D1%81%D1%82%D0%BE%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8-%D0%BF%D0%BE%D1%80%D1%82%D0%BE%D0%B2)
4. [Наблюдение за процессом выбора протоколом STP порта, исходя
из приоритета портов](https://github.com/rain360z/otus-networks/tree/main/3_lab#%D1%87%D0%B0%D1%81%D1%82%D1%8C-4%D0%BD%D0%B0%D0%B1%D0%BB%D1%8E%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B7%D0%B0-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D0%BC-%D0%B2%D1%8B%D0%B1%D0%BE%D1%80%D0%B0-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%BE%D0%BC-stp-%D0%BF%D0%BE%D1%80%D1%82%D0%B0-%D0%B8%D1%81%D1%85%D0%BE%D0%B4%D1%8F-%D0%B8%D0%B7-%D0%BF%D1%80%D0%B8%D0%BE%D1%80%D0%B8%D1%82%D0%B5%D1%82%D0%B0-%D0%BF%D0%BE%D1%80%D1%82%D0%BE%D0%B2)


![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/1.JPG)

Топология



Таблица адресов  
| Оборудование | Интерфейс  | ip-адрес | Маска |
|--------------|------------|----------|-------|
|S1|VLAN 1|192.168.1.1| 255.255.255.0|
|S2|VLAN 1|192.168.1.2|255.255.255.0|
|S3|VLAN 1|192.168.1.3|255.255.255.0|


#### Часть 1. Создание сети и настройка основных парамеров устройства

Создадим стенд по топологии сети. Настроим базовые параметры каждого коммутатора.
 Так же настроим logging synchronous для консольного канала, чтобы в случае, если IOS понадобится отправить Syslog сообщение, 
 то после его отправки, консоль вернет в сеанс терминала то, что вы уже набрали, чтобы продолжить там, где вы остановились

```
S1(config)#line console 0  
S1(config-line)#logging synchronousip

```  

... 

Проверим связь между коммутатором S1 и S2?


![alt-text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/2.PNG)

Проверим связь между коммутатором S1 и S3?  


![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/3.PNG)
Проверим связь между коммутатором S2 и S3?  


![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/4.PNG)
#### Часть 2. Выбер корневого моста

Отключим все порты кроме F0/2 и F0/4,данные порты настроим в качестве транковых и отобразим данные протокола spanning-tree.
В моем случае вместо F0/2 и F0/4,будут e0/1 и e0/3.

Коммутатор S1   

![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/5.PNG)

Коммутатор S2   
![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/6.PNG)

Коммутатор S3  
![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/7.PNG)

Приоритеты у всех коммутаторов одинаковые. Корневой мост будет выбираться на основании MAC-адресов. 
В нашем случае корневой мост S1  
![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/8.PNG)

Определим роли и состояние активных портов на каждом коммутаторе

С учетом выходных данных, поступающих с коммутаторов, ответьте на следующие вопросы.  
Какой коммутатор является корневым мостом?  
+ S1

Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?
+ Приоритеты у коммутаторов одинаковые. А вот Maс у S1 меньше. Соответственно BID меньше идентификатор. Он и будет корневым.

Какие порты на коммутаторе являются корневыми портами?
+ Корневой порт может быть только один - это порт который имееет наименьшую стоимость до корневого моста.
  Может Выбирается на основе меньшей стимости. В случае совпадения, выбирается на основе BID, в случае совпадения BID, то на основе Port id

Какие порты на коммутаторе являются назначенными портам?  
+ Это порты коммутатора через которые проложен кратчаший путь до корневого моста, в случае если корневой порт уже задан.
  Так же как и корневой порт выбирается на основе:

    - Меньшего Root Path Cost.
    - Меньшего Bridge ID.
    - Меньшего Port ID

Какой порт отображается в качестве альтернативного и в настоящее время заблокирован? 
В случае когда на коммутатор пришла BPDU с изменением топологии. Коммутатор выбирает альтернатинвый порт,
 который может заменить корневой порт в случае выхода из строя основного канала,  исходя:  
   + из стоимости порта
   + из BID соседнего(их) коммутатора
   + из приоритета порта у вышестояшего коммутатора в дереве


#### Часть 3:	Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов

STA выбирает какие порты будут заблокированы изходя из стоимости. В случае если стоимости портовравны, процесс сравнивает BID. Если BID равн,то выбирает по приоритету портов.

По Части 2 мы видим, что S3 содержит альтернативный порт. 

Изменим стоимость порта на S3

![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/10.PNG)
![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/11.PNG)
![alt text](https://github.com/rain360z/otus-networks/blob/main/3_lab/pictures/12.PNG)

Почему протокол spanning-tree заменяет ранее заблокированный порт на назначенный порт и блокирует порт, который был назначенным портом на другом коммутаторе?
+ Потому что пересчиталась стоимость до корневого порта на S2 и S3. И на S3 заблокированном порту стоимость стала меньше, чем на S2 и роль порта стала Desg.

Удалим созданную запись стоимости порта.


#### Часть 4:	Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

Активируем избыточные порты

Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста? 
+ Порт со сторны корневого моста с меньшим приоритетом порта.

Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах?
+ Так как BID одинаковые, стоимость порта тоже. То корневые порты будут выбираться в зависимости от приоритета порта корневого моста.
